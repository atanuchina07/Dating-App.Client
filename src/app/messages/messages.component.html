<div class="container mt-4">
  <div class="d-flex justify-content-center mb-3">
    <div class="btn-group" role="group" aria-label="Message Filters">
      <button
        class="btn btn-outline-primary"
        btnRadio="Unread"
        [(ngModel)]="container"
        (click)="loadMessages()"
      >
        ğŸ“© Unread
      </button>
      <button
        class="btn btn-outline-primary"
        btnRadio="Inbox"
        [(ngModel)]="container"
        (click)="loadMessages()"
      >
        ğŸ“¥ Inbox
      </button>
      <button
        class="btn btn-outline-primary"
        btnRadio="Outbox"
        [(ngModel)]="container"
        (click)="loadMessages()"
      >
        ğŸ“¤ Outbox
      </button>
    </div>
  </div>

  @if (!messageService.paginatedResult()?.items ||
  messageService.paginatedResult()?.items?.length === 0) {
  <h4 class="text-center text-muted mt-5">No messages found</h4>
  } @else {
  <table
    class="table table-hover table-striped align-middle shadow-sm rounded mt-3"
  >
    <thead class="table-light">
      <tr>
        <th style="width: 40%">Message</th>
        <th style="width: 30%">From / To</th>
        <th style="width: 20%">Date</th>
        <th style="width: 10%"></th>
      </tr>
    </thead>
    <tbody>
      @for (message of messageService.paginatedResult()?.items; track $index) {
      <tr
        [routerLink]="getRoute(message)"
        [queryParams]="{ tab: 'Messages' }"
        style="cursor: pointer"
      >
        <td>{{ message.content }}</td>
        <td class="d-flex align-items-center">
          <img
            [src]="
              isOutBox
                ? message.recipientPhotoUrl || './assets/user.png'
                : message.senderPhotoUrl || './assets/user.png'
            "
            alt="user"
            class="rounded-circle me-2"
            width="40"
            height="40"
          />
          <strong class="text-nowrap">
            {{ isOutBox ? message.recipientUsername : message.senderUsername }}
          </strong>
        </td>
        <td>{{ message.messageSent | timeago }}</td>
        <td (click)="$event.stopPropagation()">
          <!-- stoppropagation prevent the route link -->

          <button
            class="btn btn-sm btn-outline-danger"
            style="color: black"
            (click)="deleteMessage(message.id)"
          >
            Delete
          </button>
        </td>
      </tr>
      }
    </tbody>
  </table>
  } @if (messageService.paginatedResult()?.pagination &&
  messageService.paginatedResult()?.pagination?.totalItems! > 0) {
  <div class="d-flex justify-content-center mt-4">
    <pagination
      [totalItems]="(messageService.paginatedResult()?.pagination)!.totalItems"
      [itemsPerPage]="
        (messageService.paginatedResult()?.pagination)!.itemsPerPage
      "
      [(ngModel)]="pageNumber"
      (pageChanged)="pageChanged($event)"
      [maxSize]="10"
    ></pagination>
  </div>
  }
</div>
